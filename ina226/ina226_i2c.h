#include "ch32v00x_conf.h"
#define INA226_MINIMAL_SHUNT_OHM          0.001

#define INA226_MAX_WAIT_MS                600   //  millis

#define INA226_MAX_SHUNT_VOLTAGE          (81.92 / 1000)
#define INA226_I2C_TIMEOUT 5000


#define INA226_CONF_RESET    0b1000000000000000
//Averages
#define INA226_CONF_AVG_1    0b0000000000000000
#define INA226_CONF_AVG_4    0b0000001000000000
#define INA226_CONF_AVG_16   0b0000010000000000
#define INA226_CONF_AVG_64   0b0000011000000000
#define INA226_CONF_AVG_128  0b0000100000000000
#define INA226_CONF_AVG_256  0b0000101000000000
#define INA226_CONF_AVG_512  0b0000110000000000
#define INA226_CONF_AVG_1024 0b0000111000000000
//Bus conversion times
#define INA226_CONF_BUS_CONV_TIME_140us  0b0000000000000000
#define INA226_CONF_BUS_CONV_TIME_204us  0b0000000001000000
#define INA226_CONF_BUS_CONV_TIME_332us  0b0000000010000000
#define INA226_CONF_BUS_CONV_TIME_588us  0b0000000011000000
#define INA226_CONF_BUS_CONV_TIME_1100us 0b0000000100000000
#define INA226_CONF_BUS_CONV_TIME_2116us 0b0000000101000000
#define INA226_CONF_BUS_CONV_TIME_4156us 0b0000000110000000
#define INA226_CONF_BUS_CONV_TIME_8244us 0b0000000111000000
//Shunt conversion times
#define INA226_CONF_SHUNT_CONV_TIME_140us  0b0000000000000000
#define INA226_CONF_SHUNT_CONV_TIME_204us  0b0000000000001000
#define INA226_CONF_SHUNT_CONV_TIME_332us  0b0000000000010000
#define INA226_CONF_SHUNT_CONV_TIME_588us  0b0000000000011000
#define INA226_CONF_SHUNT_CONV_TIME_1100us 0b0000000000100000
#define INA226_CONF_SHUNT_CONV_TIME_2116us 0b0000000000101000
#define INA226_CONF_SHUNT_CONV_TIME_4156us 0b0000000000110000
#define INA226_CONF_SHUNT_CONV_TIME_8244us 0b0000000000111000
//Modes
#define INA226_CONF_MODE_POWER_DOWN          0b0000000000000000
#define INA226_CONF_MODE_SHUNT_VOLTAGE_TRIG  0b0000000000000001
#define INA226_CONF_MODE_BUS_VOLTAGE_TRIG    0b0000000000000010
#define INA226_CONF_MODE_SHUNT_BUS_V_TRIG    0b0000000000000011
#define INA226_CONF_MODE_POWER_DOWN_2        0b0000000000000100
#define INA226_CONF_MODE_SHUNT_VOLTAGE_CONT  0b0000000000000101
#define INA226_CONF_MODE_BUS_VOLTAGE_CONT    0b0000000000000110
#define INA226_CONF_MODE_SHUNT_BUS_V_CONT    0b0000000000000111

typedef struct
{
    uint8_t address; 
}
INA226_I2C;
//Returns Alert flag
uint16_t INA226_GetAlertFlag(INA226_I2C* ina226);
//Returns current in miliampers
int16_t INA226_GetCurrent(INA226_I2C* ina226);
//Returns shunt voltage in milivolts
int16_t INA226_GetShuntUVoltage(INA226_I2C* ina226);
//Returns Bus voltage in milivolts
uint16_t INA226_GetBusVoltage(INA226_I2C* ina226);
//Returns Power in miliwatts
uint16_t INA226_GetPower(INA226_I2C* ina226);
//Initializes module with calibration value
void INA226_I2C_Init(INA226_I2C* ina226,uint16_t calib);
//Configures with config(made with conf masks)
void INA226_Configure(INA226_I2C* ina226,uint16_t conf);
//Returns configuration made with masks
uint16_t INA226_GetConfiguration(INA226_I2C* ina226);